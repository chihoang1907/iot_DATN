<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Car Controller </title>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script>
		// Connect socket
		var socket = io.connect('http://' + location.host + '/socket')
		socket.on('connect', function() {
			console.log('Connected');
		});
		// Listen for messages
		socket.on('message', function(data) {
			console.log(data);
		});
		socket.emit('message', 'Hello World');
		// keypress event
		document.onkeypress = function(event) {
			var key_press = String.fromCharCode(event.keyCode).toLocaleLowerCase();
			console.log(key_press);
			if(key_press == 'w'){
				var speed = document.getElementById("speed").value;
				socket.emit('message', 'forward '+speed);
			}
			if(key_press == 's'){
				var speed = document.getElementById("speed").value;
				socket.emit('message', 'backward '+speed);
			}
			if(key_press == 'a'){
				socket.emit('message', 'left');
			}
			if(key_press == 'd'){
				socket.emit('message', 'right');
			}
			if(key_press == 'q'){
				socket.emit('message', 'stop');
			}
		};
		capture = function(){
			// save frame in tag img
			var frame = document.getElementById("frame");
			var canvas = document.createElement("canvas");
			canvas.width = frame.width;
			canvas.height = frame.height;
			var ctx = canvas.getContext("2d");
			ctx.drawImage(frame, 0, 0, frame.width, frame.height);
			var dataURI = canvas.toDataURL("image/jpeg");
			var save = document.createElement("a");
			save.href = dataURI;
			save.download = "capture.jpg";
			save.click();
		}
		
    </script>
	
</head>
<body>
<div id="container" class="container" align="center">
	<div style="width:60%; height:40px; line-height:40px; text-align:center; font-size:20px; color:white; background-color:blue; margin:auto">
	Robot Web Control
	</div><br><br>

    <div>
        <img id="frame" src="/stream_camera" width="640" height="480"/>
    </div>

    <p> Speed <input id="speed" type="range" min="11" max="80", style="width:300px"; value="11" onchange="document.getElementById('speed_value').innerHTML = this.value;">
	<span id="speed_value">11</span> </p>
	<button type="button" onclick="capture()">Capture</button>
</div>
</body>
</html>
